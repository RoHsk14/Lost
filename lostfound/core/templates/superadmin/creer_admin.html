{% extends "admin_base.html" %}
{% load static %}
{% load widget_tweaks %} {# pour add_class #}

{% block title %}Créer un administrateur{% endblock %}

{% block content %}
<div class="max-w-xl mx-auto mt-10 p-6 bg-white shadow-lg rounded-lg">
    <h1 class="text-2xl font-bold mb-6 text-center">Créer un administrateur</h1>

    {% if messages %}
        <ul class="mb-4">
            {% for message in messages %}
                <li class="p-2 mb-2 rounded {{ message.tags }} bg-gray-100 text-gray-800">{{ message }}</li>
            {% endfor %}
        </ul>
    {% endif %}

    <form method="post" class="space-y-4">
        {% csrf_token %}
        {{ form.non_field_errors }}

        <div>
            <label for="id_username" class="block font-medium mb-1">Nom d'utilisateur :</label>
            {{ form.username|add_class:"w-full border rounded px-3 py-2" }}
            {{ form.username.errors }}
        </div>

        <div>
            <label for="id_email" class="block font-medium mb-1">Email :</label>
            {{ form.email|add_class:"w-full border rounded px-3 py-2" }}
            {{ form.email.errors }}
        </div>

        <div>
            <label for="id_telephone" class="block font-medium mb-1">Téléphone :</label>
            {{ form.telephone|add_class:"w-full border rounded px-3 py-2" }}
            {{ form.telephone.errors }}
        </div>

        <div>
            <label for="id_region" class="block font-medium mb-1">Région :</label>
            {{ form.region|add_class:"w-full border rounded px-3 py-2" }}
            {{ form.region.errors }}
        </div>

        <div>
            <label for="id_prefecture" class="block font-medium mb-1">Préfecture :</label>
            {{ form.prefecture|add_class:"w-full border rounded px-3 py-2" }}
            {{ form.prefecture.errors }}
        </div>

        <div>
            <label for="id_password1" class="block font-medium mb-1">Mot de passe :</label>
            {{ form.password1|add_class:"w-full border rounded px-3 py-2" }}
            {{ form.password1.errors }}
        </div>

        <div>
            <label for="id_password2" class="block font-medium mb-1">Confirmation du mot de passe :</label>
            {{ form.password2|add_class:"w-full border rounded px-3 py-2" }}
            {{ form.password2.errors }}
        </div>

        <button type="submit" class="w-full bg-blue-600 text-white font-bold py-2 px-4 rounded hover:bg-blue-700 transition">
            Créer l'administrateur
        </button>
    </form>
</div>

<!-- Script JS pour remplir dynamiquement les préfectures selon la région -->
<script>
document.addEventListener('DOMContentLoaded', () => {
    const regionSelect = document.getElementById('id_region');
    const prefectureSelect = document.getElementById('id_prefecture');

    regionSelect.addEventListener('change', () => {
        const regionId = regionSelect.value;
        prefectureSelect.innerHTML = '<option value="">-- Sélectionnez une préfecture --</option>';
        if (!regionId) return;

        fetch(`/api/prefectures/?region=${regionId}`)
            .then(resp => resp.json())
            .then(data => {
                data.forEach(p => {
                    const option = document.createElement('option');
                    option.value = p.id;
                    option.textContent = p.nom;
                    prefectureSelect.appendChild(option);
                });
            })
            .catch(err => {
                console.error("Erreur API préfectures :", err);
                alert("Impossible de récupérer les préfectures pour cette région.");
            });
    });
});
</script>
{% endblock %}
